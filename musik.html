    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C. Cifuentes</title>
    <meta name="keywords" content="Carlos Cifuentes San Roman, Carlos Cifuentes, C. Cifuentes, astronomo, astrophysics, exoplanets, CARMENES, KOBE">
    <meta name="description" content="Personal page of C. Cifuentes.">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="style.css">
    <style>
        @media (max-width: 768px) {
            nav {
                display: flex !important;
                justify-content: space-between !important;
                width: 100% !important;
                gap: 0 !important;
            }
            .nav-section {
                display: flex !important;
                gap: 0 !important;
                flex: 1 !important;
                justify-content: space-evenly !important;
            }
            .nav-item {
                padding: 8px 4px !important;
                min-width: 0 !important;
                flex-shrink: 1 !important;
            }
        }
        
        /* Lyrics Modal */
        .lyrics-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .lyrics-content {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 2em;
        }
        
        .lyrics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5em;
            padding-bottom: 1em;
            border-bottom: 1px solid var(--border-color);
        }
        
        .lyrics-header h3 {
            margin: 0;
            font-size: 1.5em;
            color: var(--text-color);
        }
        
        .close-lyrics {
            font-size: 2em;
            cursor: pointer;
            color: var(--text-secondary);
            line-height: 1;
            transition: color 0.2s;
        }
        
        .close-lyrics:hover {
            color: var(--text-color);
        }
        
        .lyrics-text {
            white-space: pre-line;
            line-height: 1.8;
            color: black;
        }
        
        .lyrics-icon {
            cursor: pointer;
            padding: 0 8px;
            transition: transform 0.2s;
            display: inline-block;
        }
        
        .lyrics-icon:hover {
            transform: scale(1.2);
        }
        
        .track-name {
            flex: 1;
        }
        
        .track-year {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-left: auto;
        }
        
        .track-list li {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Navigation link styles - High specificity to override external CSS */
        nav a[href="science.html"],
        .nav-section a[href="science.html"] {
            text-decoration: none !important;
            color: white !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif !important;
        }

        /* Science link - black in light mode */
        [data-theme="light"] .nav-section a[href="science.html"] {
            color: #000 !important;
        }

        nav a[href="echoes.html"],
        .nav-section a[href="echoes.html"],
        nav a[href="seen.html"],
        .nav-section a[href="seen.html"] {
            color: #666 !important;
            pointer-events: none !important;
            cursor: default !important;
            text-decoration: none !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif !important;
        }

        /* Logo Musik styling */
        .logo div:nth-child(2) {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif !important;
        }

        /* Hover effect for nav items - lighter in dark mode, but not for active items */
        [data-theme="dark"] .nav-item:not(.active):hover {
            background: rgba(255, 255, 255, 0.15) !important;
        }

        [data-theme="light"] .nav-item:not(.active):hover {
            background: rgba(0, 0, 0, 0.05) !important;
        }

        /* Piano page h3 titles white in dark mode */
        [data-theme="dark"] #piano-page h3 {
            color: #ffffff !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div style="font-size: 16px; color: var(--text-secondary); font-weight: 400; ">C. Cifuentes</div>
                <div style="font-size: 30px; font-weight: 400; letter-spacing: -0.02em;">Musik</div>
            </div>
            
            <nav>
                <div class="nav-section">
                    <a href="index.html" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                        <span>Home</span>
                    </a>
                    <a href="/about" class="nav-item active">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span>About</span>
                    </a>
                    <a href="/kosmona" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>
                        <span>Kosmona</span>
                    </a>
                    <a href="/agricola" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        <span>Agricola</span>
                    </a>
                    <a href="/piano" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 18V5l12-2v13M9 18c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm12-5c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3z"/></svg>
                        <span>Piano</span>
                    </a>
                    <a href="/equipment" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4m13.657-5.657l-11.314 11.314m0-11.314l11.314 11.314"/></svg>
                        <span>Equipment</span>
                    </a>
                    <span style="color: var(--border-color); padding: 0 4px; display: flex; align-items: center;">|</span>
                </div>

                <div class="nav-section">
                    <h3>Resources</h3>
                    <a href="science.html" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3c.132 0 .263 0 .393.01c3.753.358 6.607 3.7 6.607 7.733c0 4.287-3.134 7.773-7 7.773S5 15.02 5 10.732C5 6.702 7.854 3.368 11.607 3.01c.13-.007.261-.01.393-.01zM12 1C6.477 1 2 5.373 2 10.733c0 3.393 1.889 6.35 4.667 7.92l.333 3.667h2l.667-2.333h3.666l.667 2.333h2l.333-3.667C20.111 17.083 22 14.126 22 10.733 22 5.373 17.523 1 12 1z"/></svg>
                        <span>Science</span>
                    </a>
                    <a href="seen.html" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                        <span>Seen</span>
                    </a>
                    <a href="echoes.html" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/></svg>
                        <span>Echoes</span>
                    </a>
                </div>
            </nav>

            <div class="theme-toggle">
                <div class="theme-options">
                    <span class="theme-option" data-theme="light">Light</span>
                    <span class="theme-option" data-theme="dark">Dark</span>
                    <span class="theme-option active" data-theme="auto">Auto</span>
                </div>
            </div>

            <!-- Global Audio Player -->
            <div id="global-player">
                <audio id="global-audio"></audio>
                <div class="player-controls">
                    <button class="play-btn" onclick="togglePlayGlobal()">‚ñ∂</button>
                    <div class="player-right">
                        <div id="global-progress-container" onclick="setProgressGlobal(event)">
                            <div id="global-progress-bar"></div>
                        </div>
                        <div class="player-times">
                            <span id="global-current-time">0:00</span>
                            <span id="global-duration">0:00</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <style>
            /* Active track styling - bold text with black circle indicator */
            .playing {
                font-weight: bold !important;
                color: var(--text-color) !important;
            }
            
            .playing span {
                font-weight: bold !important;
                color: var(--text-color) !important;
            }

            /* Black circle indicator for playing track */
            .playing::before {
                content: '‚óè ';
                color: #000000;
                font-size: 0.8em;
                font-weight: bold;
                margin-left: -16px;
                margin-right: 8px;
                display: inline-block;
                width: 8px;
            }
            
            /* White circle in dark mode */
            @media (prefers-color-scheme: dark) {
                .playing::before {
                    color: #ffffff;
                }
            }
            
            [data-theme="dark"] .playing::before {
                color: #ffffff;
            }

            /* Cursor pointer for track lists */
            .track-list li {
                cursor: pointer;
            }

            /* Player display styling */
            #player-display {
                display: flex;
                flex-direction: column;
                gap: 6px;
                width: 100%;
            }

            /* Player responsive behavior */
            @media (max-width: 768px) {
                #global-player {
                    display: block !important;
                }
            }

            /* Ensure progress bar container works properly */
            #global-progress-container {
                overflow: visible !important;
                box-sizing: border-box !important;
            }

            #global-progress-bar {
                overflow: visible !important;
                box-sizing: border-box !important;
                z-index: 1;
            }

            /* Global Player Styles */
            #global-player {
                margin-top: auto;
                padding-top: 24px;
                border-top: 1px solid var(--border-color);
            }

            .player-controls {
                display: flex;
                gap: 8px;
                align-items: flex-start;
            }

            #global-player .play-btn {
                background: var(--text-color);
                color: var(--bg-color);
                border: none;
                border-radius: 6px;
                width: 36px;
                height: 36px;
                cursor: pointer;
                font-size: 14px;
                flex-shrink: 0;
                margin-top: 2px;
            }

            .player-right {
                flex: 1;
                min-width: 0;
                max-width: calc(100% - 44px);
            }

            /* Mobile-specific adjustments for progress bar */
            @media (max-width: 768px) {
                .player-right {
                    max-width: calc(100vw - 80px);
                }
                
                #global-progress-container {
                    max-width: 100%;
                }
            }

            #global-progress-container {
                width: 100%;
                height: 8px;
                background-color: var(--border-color);
                border-radius: 4px;
                cursor: pointer;
                position: relative;
            }

            #global-progress-bar {
                height: 100%;
                background-color: var(--text-color);
                width: 0%;
                border-radius: 4px;
                position: absolute;
                top: 0;
                left: 0;
                z-index: 2;
                transition: width 0.1s ease;
                box-sizing: border-box;
            }

            .player-times {
                display: flex;
                justify-content: space-between;
                font-size: 11px;
                color: var(--text-color);
                width: 100%;
                font-weight: 600;
                margin-top: 6px;
            }
        </style>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-wrapper">
            <div id="about-page">
                <h1>Welcome to Musik</h1>

                <section style="margin-top: 3em;">
                    <p style="color: var(--text-secondary); margin-bottom: 2em; font-size: 1.1em; line-height: 1.6;">
                        This is my personal music space, where I explore different sonic territories. From electronic soundscapes inspired by celestial mechanics to raw metal expressions, each project represents a unique approach to sound and composition.
                    </p>

                    <div style="display: grid; gap: 2em; margin-top: 2em;">
                        <!-- Kosmona -->
                        <div style="padding: 1.5em; border-left: 3px solid var(--border-color); background: var(--hover-bg); border-radius: 6px;">
                            <h3 style="margin: 0 0 0.5em 0; color: var(--text-color);">Kosmona</h3>
                            <p style="color: var(--text-secondary); margin: 0; line-height: 1.6;">
                                An electronica project inspired by the Keplerian motion.
                            </p>
                        </div>

                        <!-- Agricola -->
                        <div style="padding: 1.5em; border-left: 3px solid var(--border-color); background: var(--hover-bg); border-radius: 6px;">
                            <h3 style="margin: 0 0 0.5em 0; color: var(--text-color);">Agricola</h3>
                            <p style="color: var(--text-secondary); margin: 0; line-height: 1.6;">
                                A metal project that gives voice to other animals on Earth.
                            </p>
                        </div>

                        <!-- Piano -->
                        <div style="padding: 1.5em; border-left: 3px solid var(--border-color); background: var(--hover-bg); border-radius: 6px;">
                            <h3 style="margin: 0 0 0.5em 0; color: var(--text-color);">Piano</h3>
                            <p style="color: var(--text-secondary); margin: 0; line-height: 1.6;">
                                Piano compositions and renditions spanning different moods and styles, including my own unfinished album under the artist name "Carlic".
                            </p>
                        </div>
                    </div>

                    <div style="margin-top: 3em; padding: 1.5em; background: var(--hover-bg); border-radius: 6px; text-align: center;">
                        <p style="color: var(--text-secondary); margin: 0; font-style: italic;">
                            My own recordings span from 2009 to the present. Headphones are recommended for the best experience.
                        </p>
                    </div>
                </section>
            </div>

            <div id="kosmona-page" style="display: none;">
                <h1>Kosmona</h1>

                <!-- Kosmona Section -->
                <section id="kosmona" style="margin-top: 3em;">
                    <p style="color: var(--text-secondary); margin-bottom: 1.5em;"><strong>Kosmona</strong> is an electronica project inspired by the
                         planetary orbital elements.</p>
                    
                    <div style="padding: 1.5em; border-left: 3px solid var(--border-color); background: var(--hover-bg); margin: 1.5em 0; border-radius: 6px;">
                        <p style="color: var(--text-secondary); margin: 0;">Six fundamental parameters define a celestial body's orbit: the semi-major axis (orbit size), eccentricity (orbit shape), inclination (orbital plane tilt), longitude of the ascending node (where the orbit crosses the reference plane), argument of periapsis (orientation of the orbit's closest point), and true anomaly (the body's position along its orbit).</p>
                    </div>
                    
                    <ul style="display: flex; flex-direction: column; gap: 0; margin: 1.5em 0; list-style: none; padding: 0;">
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: default; color: var(--text-color); display: flex; align-items: center; gap: 12px;"><span style="font-weight: 500; flex: 1;">01 Semi-major axis</span><span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">processing...</span></li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/orbital_02_eccentricity.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">02 Eccentricity</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">ready</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: default; color: var(--text-color); display: flex; align-items: center; gap: 12px;"><span style="font-weight: 500; flex: 1;">03 Inclination</span><span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">processing...</span></li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/orbital_04_longitude.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">04 Longitude of the ascending node</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">ready</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/orbital_05_argument.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">05 Argument of periapsis</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">ready</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/orbital_06_trueanomaly.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">06 True Anomaly</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">ready</span>
                        </li>
                        <li style="padding: 1em 0; cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="window.open('https://www.youtube.com/watch?v=pHGvzTXnM0E', '_blank')">
                            <span style="font-weight: 500; flex: 1;">(Clip) True Anomaly ‚Üó</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">ready</span>
                        </li>
                    </ul>
                </section>

            </div>

            <div id="agricola-page" style="display: none;">
                <h1>Agricola</h1>
                
                <!-- Agricola Section -->
                <section id="agricola" style="margin-top: 3em;">
                    <p style="color: var(--text-secondary); margin-bottom: 1.5em;"><strong>AGRICOLA</strong> is a metal project that gives voice to different animals.</p>

                    <div style="padding: 1.5em; border-left: 3px solid var(--border-color); background: var(--hover-bg); margin: 1.5em 0; border-radius: 6px;">
                        <p style="color: var(--text-secondary); margin: 0;">This music is built upon drum tracks designed by Arnaud Krakowka. Bass lines are absent. Guitar playing is poor and clunky. Human voices are barely distinguishable (<i>nihil novum sub sole</i>). 
                            AGRICOLA gives voice to animals such as dog (Rottweiler), sheep, cow, kiwi, chimpanzee, grebe, and dinosaur (Broncosaurus Rex).
                            Click on the paw  <span style="font-size:1.1em;">üêæ</span> to find the lyrics and some recording details.</p>
                    </div>
                    
                    <ul style="display: flex; flex-direction: column; gap: 0; margin: 1.5em 0; list-style: none; padding: 0;">
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/agricola_triangles.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">01 TRIANGLES</span>
                            <span style="cursor: pointer; padding: 0 8px; transition: transform 0.2s; display: inline-block;" onclick="event.stopPropagation(); showLyrics('triangles')" title="Ver letras">üêæ</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">2018</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/agricola_dormant.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">02 DORMANT</span>
                            <span style="cursor: pointer; padding: 0 8px; transition: transform 0.2s; display: inline-block;" onclick="event.stopPropagation(); showLyrics('dormant')" title="Ver letras">üêæ</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">2019</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/agricola_haunt.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">03 HAUNT</span>
                            <span style="cursor: pointer; padding: 0 8px; transition: transform 0.2s; display: inline-block;" onclick="event.stopPropagation(); showLyrics('haunt')" title="Ver letras">üêæ</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">2019</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/agricola_bones.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">04 BONES</span>
                            <span style="cursor: pointer; padding: 0 8px; transition: transform 0.2s; display: inline-block;" onclick="event.stopPropagation(); showLyrics('bones')" title="Ver letras">üêæ</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">2019</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/agricola_puma.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">05 PUMA</span>
                            <span style="cursor: pointer; padding: 0 8px; transition: transform 0.2s; display: inline-block;" onclick="event.stopPropagation(); showLyrics('puma')" title="Ver letras">üêæ</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">2021</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/agricola_pig.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">06 PIG</span>
                            <span style="cursor: pointer; padding: 0 8px; transition: transform 0.2s; display: inline-block;" onclick="event.stopPropagation(); showLyrics('pig')" title="Ver letras">üêæ</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">2024</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/agricola_triangles_remix1.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">R01 TRIANGLES DIVINITY REMIX</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">2024</span>
                        </li>
                        <li style="padding: 1em 0; border-bottom: 1px solid var(--border-color); cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/agricola_triangles_remix2.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">R02 TRIANGLES ENIGMA REMIX</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">2024</span>
                        </li>
                        <li style="padding: 1em 0; cursor: pointer; color: var(--text-color); display: flex; align-items: center; gap: 12px;" onclick="loadTrack('media/music/agricola_puma_remix1.mp3', this)">
                            <span style="font-weight: 500; flex: 1;">R03 PUMA PUNK REMIX</span>
                            <span style="color: var(--text-secondary); font-size: 0.9em; margin-left: auto;">2024</span>
                        </li>
                    </ul>
                </section>
            </div>

            <div id="piano-page" style="display: none;">
                <div class="note-box">
                <h2>Piano</h2>
                <p>Collection of on-the-fly improvisations, early ideas and personal renditions for piano.</p>
                <!-- Y  ou can also explore my playlists on Spotify ‚Üó. -->
                </div>
                
                <h3 style="color: #191919; font-size: 1.2rem; margin-top: 2rem; margin-bottom: 1rem;">Carlic</h3>
                <iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/artist/1FTCTlOPZVIhT7wqBfYMpc?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                
                <h3 style="color: #191919; font-size: 1.2rem; margin-top: 2rem; margin-bottom: 1rem;">Improvised originals</h3>
                <ul class="track-list">
                    <li onclick="loadTrack('media/music/piano_original_things.mp3', this)"><span class="track-name">The Things That Be</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_run.mp3', this)"><span class="track-name">Run & Love</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_colma.mp3', this)"><span class="track-name">Colma</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_chiller.mp3', this)"><span class="track-name">Chiller</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_meanwhile.mp3', this)"><span class="track-name">Meanwhile</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_breeze.mp3', this)"><span class="track-name">Gentle Breeze Of February</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_three.mp3', this)"><span class="track-name">3:30</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_create.mp3', this)"><span class="track-name">Create</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_vinteren.mp3', this)"><span class="track-name">Vinteren</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_door.mp3', this)"><span class="track-name">An Open Door</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_waltz.mp3', this)"><span class="track-name">Colloquy of Waltz</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_wonder.mp3', this)"><span class="track-name">To The Wonder</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_shorewards.mp3', this)"><span class="track-name">Shorewards</span><span class="track-year">improv</span></li>
                    <li onclick="loadTrack('media/music/piano_original_dolphins.mp3', this)"><span class="track-name">Why Dolphins Leave</span><span class="track-year">improv</span></li>
                </ul>

                <h3 style="color: #191919; font-size: 1.2rem; margin-top: 2rem; margin-bottom: 1rem;">Early sketches</h3>
                <ul class="track-list">
                    <li onclick="loadTrack('media/music/ideas_message.mp3', this)"><span class="track-name">Message</span><span class="track-year">2014</span></li>
                    <li onclick="loadTrack('media/music/ideas_fly.mp3', this)"><span class="track-name">Flying Away</span><span class="track-year">2013</span></li>
                    <li onclick="loadTrack('media/music/ideas_intro.mp3', this)"><span class="track-name">Untitled Intro</span><span class="track-year">2013</span></li>
                    <li onclick="loadTrack('media/music/ideas_strings.mp3', this)"><span class="track-name">Smart Strings</span><span class="track-year">2012</span></li>
                    <li onclick="loadTrack('media/music/ideas_loose.mp3', this)"><span class="track-name">Loose Ends</span><span class="track-year">2012</span></li>
                    <li onclick="loadTrack('media/music/ideas_mint.mp3', this)"><span class="track-name">Mint</span><span class="track-year">2012</span></li>
                    <li onclick="loadTrack('media/music/ideas_machine.mp3', this)"><span class="track-name">To Keep A Time Machine</span><span class="track-year">2011</span></li>
                    <li onclick="loadTrack('media/music/ideas_handsome.mp3', this)"><span class="track-name">A Handsome Devil</span><span class="track-year">2010</span></li>
                    <li onclick="loadTrack('media/music/ideas_F7.mp3', this)"><span class="track-name">F7</span><span class="track-year">2009</span></li>
                </ul>

                <h3 style="color: #191919; font-size: 1.2rem; margin-top: 2rem; margin-bottom: 1rem;">Personal renditions</h3>
                <ul class="track-list">
                    <li onclick="loadTrack('media/music/piano_olafur_saman.mp3', this)"><span class="track-name">Saman / √ìlafur Arnalds</span><span class="track-year">2021</span></li>
                    <li onclick="loadTrack('media/music/piano_frahm_sweet.mp3', this)"><span class="track-name">Sweet Little Lie / Nils Frahm</span><span class="track-year">2021</span></li>
                    <li onclick="loadTrack('media/music/piano_rammstein_sonne.mp3', this)"><span class="track-name">Sonne / Rammstein</span><span class="track-year">2021</span></li>
                    <li onclick="loadTrack('media/music/piano_frahm_familiar.mp3', this)"><span class="track-name">Familiar / Nils Frahm</span><span class="track-year">2020</span></li>
                    <li onclick="loadTrack('media/music/piano_beving_brings.mp3', this)"><span class="track-name">The Light She Brings / Joep Beving</span><span class="track-year">2020</span></li>
                    <li onclick="loadTrack('media/music/piano_eluvium_ballet.mp3', this)"><span class="track-name">Radio Ballet / Eluvium</span><span class="track-year">2016</span></li>
                    <li onclick="loadTrack('media/music/piano_hisaishi_summer2.mp3', this)"><span class="track-name">Summer / Joe Hisaishi & Vanessa James</span><span class="track-year">2015</span></li>
                    <li onclick="loadTrack('media/music/piano_horner_forest.mp3', this)"><span class="track-name">Exploring The Forest / James Horner</span><span class="track-year">2014</span></li>
                    <li onclick="loadTrack('media/music/piano_andrews_gretchen.mp3', this)"><span class="track-name">Gretchen Ross / Michael Andrews</span><span class="track-year">2014</span></li>
                    <li onclick="loadTrack('media/music/piano_hisaishi_summer.mp3', this)"><span class="track-name">Summer / Joe Hisaishi</span><span class="track-year">2013</span></li>
                    <li onclick="loadTrack('media/music/piano_bach_crab.mp3', this)"><span class="track-name">Musikalisches Opfer, BWV 1079 / Bach</span><span class="track-year">2013</span></li>
                    <li onclick="loadTrack('media/music/piano_tiersen_comptine.mp3', this)"><span class="track-name">Comptine D'Un Autre √ât√© / Yann Tiersen</span><span class="track-year">2013</span></li>
                    <li onclick="loadTrack('media/music/piano_arnalds_tomorrow.mp3', this)"><span class="track-name">Tomorrow's Song / √ìlafur Arnalds</span><span class="track-year">2013</span></li>
                    <li onclick="loadTrack('media/music/piano_nyman_secret.mp3', this)"><span class="track-name">Big My Secret / Michael Nyman</span><span class="track-year">2012</span></li>
                    <li onclick="loadTrack('media/music/piano_nyman_heart.mp3', this)"><span class="track-name">The Heart Asks Pleasure First / Michael Nyman</span><span class="track-year">2012</span></li>
                    <li onclick="loadTrack('media/music/piano_satie_gymnopedie.mp3', this)"><span class="track-name">Gymnop√©die 1 / Erik Satie</span><span class="track-year">2011</span></li>
                    <li onclick="loadTrack('media/music/piano_kondo_kakariko.mp3', this)"><span class="track-name">Kakariko Village (Zelda) / Koji Kondo</span><span class="track-year">2011</span></li>
                    <li onclick="loadTrack('media/music/piano_horner_rose.mp3', this)"><span class="track-name">Rose Theme (Titanic) / James Horner</span><span class="track-year">2011</span></li>
                </ul>

                <h3 style="color: #000000; font-size: 1.2rem; margin-top: 3rem; margin-bottom: 1rem;">Chopin: unintentionally unfinished</h3>
                <ul class="track-list">
                    <li onclick="loadTrack('media/music/piano_chopin_nocturne9_1.mp3', this)"><span class="track-name">Nocturne Op.9 no.1 / Chopin</span><span class="track-year">2012</span></li>
                    <li onclick="loadTrack('media/music/piano_chopin_nocturne9_2.mp3', this)"><span class="track-name">Nocturne Op.9 no.2 / Chopin</span><span class="track-year">2012</span></li>
                    <li onclick="loadTrack('media/music/piano_chopin_nocturne15_1.mp3', this)"><span class="track-name">Nocturne Op.15 no.1 / Chopin</span><span class="track-year">2012</span></li>
                    <li onclick="loadTrack('media/music/piano_chopin_nocturne15_2.mp3', this)"><span class="track-name">Nocturne Op.15 no.2 / Chopin</span><span class="track-year">2012</span></li>
                    <li onclick="loadTrack('media/music/piano_chopin_nocturne28_4.mp3', this)"><span class="track-name">Nocturne Op.28 no.4 / Chopin</span><span class="track-year">2017</span></li>
                </ul>
            </section>

            <!-- Lest we forget Section -->
            <section id="lest" class="musik-section">
                <h2>Lest we forget</h2>
                <ul class="track-list">
                    <li onclick="window.open('https://www.youtube.com/watch?v=D_yy9ZDid-0', '_blank')">
                        <span class="track-name">Saman / √ìlafur Arnalds ‚Üó</span>
                        <span class="track-year">2021</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=4C97WGNEEd8', '_blank')">
                        <span class="track-name">Sweet Little Lie / Nils Frahm ‚Üó</span>
                        <span class="track-year">2021</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=1NNvhRrAm6I', '_blank')">
                        <span class="track-name">The Light She Brings / Joep Beving ‚Üó</span>
                        <span class="track-year">2020</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=pZRRReEHGKk', '_blank')">
                        <span class="track-name">Familiar / Nils Frahm ‚Üó</span>
                        <span class="track-year">2020</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=QCKAxC6Tvbg', '_blank')">
                        <span class="track-name">Radio Ballet / Eluvium ‚Üó</span>
                        <span class="track-year">2016</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=XZ-nJzDQdOE', '_blank')">
                        <span class="track-name">Summer / Joe Hisaishi & Vanessa James ‚Üó</span>
                        <span class="track-year">2015</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=52lETwqArF8', '_blank')">
                        <span class="track-name">Gretchen Ross / Michael Andrews ‚Üó</span>
                        <span class="track-year">2014</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=yYmRo3zQzhM', '_blank')">
                        <span class="track-name">Exploring The Forest / James Horner ‚Üó</span>
                        <span class="track-year">2014</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=_LeYbDFmik4', '_blank')">
                        <span class="track-name">Tomorrow's Song / √ìlafur Arnalds ‚Üó</span>
                        <span class="track-year">2013</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=PUfiqJ9EF7s', '_blank')">
                        <span class="track-name">Big My Secret / Michael Nyman ‚Üó</span>
                        <span class="track-year">2013</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=efbUNQ6pWgI', '_blank')">
                        <span class="track-name">The Heart Asks Pleasure First / Michael Nyman ‚Üó</span>
                        <span class="track-year">2013</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=ng6IQTRmMBU', '_blank')">
                        <span class="track-name">Gnossienne No. 1 / Erik Satie ‚Üó</span>
                        <span class="track-year">2013</span>
                    </li>
                    <li onclick="window.open('https://www.youtube.com/watch?v=H7o4vA6Hu9Q', '_blank')">
                        <span class="track-name">Kakariko Village (Zelda) / Koji Kondo ‚Üó</span>
                        <span class="track-year">2012</span>
                    </li>
                </ul>
            </section>

            </div>

            <div id="equipment-page" style="display: none;">
                <h1>Equipment</h1>

                <div class="tabs">
                    <div class="tab active" data-tab="instruments">Instruments</div>
                    <div class="tab" data-tab="software">Software</div>
                    <div class="tab" data-tab="past">Past</div>
                </div>

                <div class="tab-content">
                    <!-- Instruments Tab -->
                    <div id="instruments-content" class="tab-pane active">
                        <section id="equipment" class="musik-section">                            
                            <ul class="equipment-list">
                                <li><span class="equipment-label">Audio interface:</span> <span>Focusrite Scarlett 2i4</span></li>
                                <li><span class="equipment-label">Studio monitors:</span> <span>Rokit KRK G4 5</span></li>
                                <li><span class="equipment-label">Microphone:</span> <span>R√∏de NT1-A</span></li>
                                <li><span class="equipment-label">MIDI keyboard:</span> <span>Midistart Music</span></li>
                                <li><span class="equipment-label">Digital piano:</span> <span>Yamaha P85</span></li>
                                <li><span class="equipment-label">Electric guitar:</span> <span>Fender Showmaster</span></li>
                                <li><span class="equipment-label">Acoustic guitar:</span> <span>Cort L-450</span></li>
                                <li><span class="equipment-label">Electronic drum kit:</span> <span>Millenium MPS-850 + stand</span></li>
                                <li><span class="equipment-label">Computer:</span> <span>MacBook Pro 16 in (2020-today)</span></li>
                            </ul>
                        </section>
                    </div>

                    <!-- Software Tab -->
                    <div id="software-content" class="tab-pane" style="display: none;">
                        <section id="software" class="musik-section">
                            
                            <ul class="equipment-list">
                                <li><span class="equipment-label">Piano VST:</span> <span>Piano Noire</span></li>
                                <li><span class="equipment-label">DAW:</span> <span>Garage Band</span></li>
                                <li><span class="equipment-label">Composition:</span> <span>Guitar Pro</span></li>
                            </ul>
                        </section>
                    </div>

                    <!-- Past Tab -->
                    <div id="past-content" class="tab-pane" style="display: none;">
                        <section id="past-equipment" class="musik-section">
                            
                            <ul class="equipment-list">
                                <li><span class="equipment-label">Pedalboard:</span> <span>POD XT Live</span></li>
                                <li><span class="equipment-label">Headphones:</span> <span>Superlux HD 681</span></li>
                                <li><span class="equipment-label">Computer:</span> <span>MacBook Pro 13 in (2011-2020)</span></li>
                            </ul>
                        </section>
                    </div>
                </div>
            </div>
            </div>
        </main>
    </div>

    <script>
        // Theme handling
        function applyTheme(theme) {
            if (theme === 'auto') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'auto';
            applyTheme(savedTheme);
            
            // Update active theme option
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.toggle('active', option.dataset.theme === savedTheme);
            });
        }

        // Theme toggle listeners
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', () => {
                const theme = option.dataset.theme;
                localStorage.setItem('theme', theme);
                applyTheme(theme);
                
                // Update active state
                document.querySelectorAll('.theme-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                option.classList.add('active');
            });
        });

        // Listen for system theme changes when in auto mode
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            const currentTheme = localStorage.getItem('theme') || 'auto';
            if (currentTheme === 'auto') {
                applyTheme('auto');
            }
        });

        // Initialize theme on load
        initTheme();

        // Tab functionality for About page
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.getAttribute('data-tab');
                if (!targetTab) return;

                // Update active tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Update active content
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.style.display = 'none';
                    pane.classList.remove('active');
                });
                
                const targetContent = document.getElementById(`${targetTab}-content`);
                if (targetContent) {
                    targetContent.style.display = 'block';
                    targetContent.classList.add('active');
                }
            });
        });

        // Navigation handling
        const navItems = document.querySelectorAll('.nav-item');
        const aboutPage = document.getElementById('about-page');
        const kosmonaPage = document.getElementById('kosmona-page');
        const pianoPage = document.getElementById('piano-page');
        const agricolaPage = document.getElementById('agricola-page');
        const equipmentPage = document.getElementById('equipment-page');

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                const href = item.getAttribute('href');
                
                if (['/about', '/kosmona', '/piano', '/agricola', '/equipment'].includes(href)) {
                    e.preventDefault();
                    
                    // Hide all pages
                    aboutPage.style.display = 'none';
                    kosmonaPage.style.display = 'none';
                    pianoPage.style.display = 'none';
                    agricolaPage.style.display = 'none';
                    equipmentPage.style.display = 'none';
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Show corresponding page
                    if (href === '/about') {
                        aboutPage.style.display = 'block';
                        document.title = 'C. Cifuentes ¬∑ Musik';
                    } else if (href === '/kosmona') {
                        kosmonaPage.style.display = 'block';
                        document.title = 'C. Cifuentes ¬∑ Kosmona';
                    } else if (href === '/piano') {
                        pianoPage.style.display = 'block';
                        document.title = 'C. Cifuentes ¬∑ Piano';
                    } else if (href === '/agricola') {
                        agricolaPage.style.display = 'block';
                        document.title = 'C. Cifuentes ¬∑ Agricola';
                    } else if (href === '/equipment') {
                        equipmentPage.style.display = 'block';
                        document.title = 'C. Cifuentes ¬∑ Equipment';
                    }
                }
            });
        });

        // Handle initial page load based on URL
        const currentPath = window.location.pathname;
        if (currentPath === '/equipment') {
            aboutPage.style.display = 'none';
            kosmonaPage.style.display = 'none';
            pianoPage.style.display = 'none';
            agricolaPage.style.display = 'none';
            equipmentPage.style.display = 'block';
            
            // Update active nav item
            navItems.forEach(nav => nav.classList.remove('active'));
            document.querySelector('a[href="/equipment"]').classList.add('active');
            document.title = 'C. Cifuentes ¬∑ Equipment';
        } else if (currentPath === '/piano') {
            aboutPage.style.display = 'none';
            kosmonaPage.style.display = 'none';
            pianoPage.style.display = 'block';
            agricolaPage.style.display = 'none';
            equipmentPage.style.display = 'none';
            
            navItems.forEach(nav => nav.classList.remove('active'));
            document.querySelector('a[href="/piano"]').classList.add('active');
            document.title = 'C. Cifuentes ¬∑ Piano';
        } else if (currentPath === '/agricola') {
            aboutPage.style.display = 'none';
            kosmonaPage.style.display = 'none';
            pianoPage.style.display = 'none';
            agricolaPage.style.display = 'block';
            equipmentPage.style.display = 'none';
            
            navItems.forEach(nav => nav.classList.remove('active'));
            document.querySelector('a[href="/agricola"]').classList.add('active');
            document.title = 'C. Cifuentes ¬∑ Agricola';
        } else if (currentPath === '/kosmona') {
            aboutPage.style.display = 'none';
            kosmonaPage.style.display = 'block';
            pianoPage.style.display = 'none';
            agricolaPage.style.display = 'none';
            equipmentPage.style.display = 'none';
            
            navItems.forEach(nav => nav.classList.remove('active'));
            document.querySelector('a[href="/kosmona"]').classList.add('active');
            document.title = 'C. Cifuentes ¬∑ Kosmona';
        } else {
            // Default to about page
            aboutPage.style.display = 'block';
            kosmonaPage.style.display = 'none';
            pianoPage.style.display = 'none';
            agricolaPage.style.display = 'none';
            equipmentPage.style.display = 'none';
            
            navItems.forEach(nav => nav.classList.remove('active'));
            document.querySelector('a[href="/about"]').classList.add('active');
            document.title = 'C. Cifuentes ¬∑ Musik';
        }

        // ===== THESIS CHAT FUNCTIONS =====
        function showProgress() {
            const bar = document.getElementById("progressBar");
            let width = 0;
            return setInterval(() => {
                if (width < 90) {
                    width += 1;
                    bar.style.width = width + "%";
                }
            }, 50);
        }

        function addMessage(content, type) {
            const messagesEl = document.getElementById("chatMessages");
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = 'padding: 0.8em; background: ' + (type === 'user' ? 'var(--text-color)' : 'var(--hover-bg)') + '; color: ' + (type === 'user' ? 'var(--bg-color)' : 'var(--text-color)') + '; border-radius: 6px; margin-bottom: 0.8em;';
            messageDiv.innerHTML = '<p style="margin: 0; font-size: 0.9em;">' + content + '</p>';
            messagesEl.appendChild(messageDiv);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        async function askThesis() {
            const questionEl = document.getElementById("question");
            if (!questionEl) return;
            
            const question = questionEl.value.trim();
            if (!question) return;

            addMessage(question, 'user');

            const btn = document.getElementById("askBtn");
            const container = document.getElementById("progressContainer");

            questionEl.value = '';

            if (btn) {
                btn.disabled = true;
                btn.style.opacity = 0.6;
            }
            if (container) {
                container.style.display = "block";
            }

            const interval = showProgress();

            try {
                const res = await fetch("https://ccifuentesr-github-io.onrender.com/ask", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question })
                });

                const data = await res.json();
                clearInterval(interval);

                const bar = document.getElementById("progressBar");
                bar.style.width = "100%";

                container.style.transition = "opacity 0.3s ease";
                container.style.opacity = 0;
                setTimeout(() => {
                    container.style.display = "none";
                    container.style.opacity = 1;
                    bar.style.width = "0%";
                }, 300);

                const rawAnswer = data.answer || "No answer.";
                let formatted = rawAnswer
                    .replace(/^### (.*$)/gim, "<h3>$1</h3>")
                    .replace(/^## (.*$)/gim, "<h2>$1</h2>")
                    .replace(/^# (.*$)/gim, "<h1>$1</h1>")
                    .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
                    .replace(/\*(.*?)\*/g, "<em>$1</em>")
                    .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>')
                    .replace(/^\s*[-+*]\s+(.*)/gim, "<li>$1</li>")
                    .replace(/(<li>.*<\/li>)/gims, "<ul>$1</ul>")
                    .replace(/\n/g, "<br>");

                if (data.chunks && data.chunks.length > 0) {
                    formatted += "<br><br><strong>Sources</strong><ul>";
                    data.chunks.forEach(c => {
                        formatted += `<li>${c}</li>`;
                    });
                    formatted += "</ul>";
                }

                addMessage(formatted, 'bot');

            } catch (err) {
                clearInterval(interval);
                container.style.display = "none";
                addMessage("Uh-oh, I'm lost for words...", 'bot');
            } finally {
                btn.disabled = false;
                btn.style.opacity = 1;
            }
        }

        const questionElement = document.getElementById("question");
        if (questionElement) {
            questionElement.addEventListener("keypress", function(e) {
                if (e.key === "Enter") {
                    askThesis();
                }
            });
        }

        // ===== CATALOGUE SEARCH FUNCTIONS =====
        function updateSearchPlaceholder() {
            const catalogEl = document.getElementById('catalog-select');
            const searchInput = document.getElementById('unified-search');
            
            if (!catalogEl || !searchInput) return;
            
            const catalog = catalogEl.value;
            const karmnCatalogues = ['cifuentes25', 'cifuentes20', 'schweitzer19', 'cortes-contreras24'];
            
            if (karmnCatalogues.includes(catalog)) {
                searchInput.placeholder = 'Object name or Karmn identifier (e.g., J00026+383)...';
            } else {
                searchInput.placeholder = 'Object name...';
            }
        }

        async function unifiedSearch() {
            const catalogEl = document.getElementById('catalog-select');
            const searchInput = document.getElementById('unified-search');
            const resultElement = document.getElementById('unified-result');
            
            if (!catalogEl || !searchInput) return;
            
            const catalog = catalogEl.value;
            const searchTerm = searchInput.value.trim();

            if (!catalog) {
                resultElement.style.display = 'block';
                resultElement.style.background = 'var(--hover-bg)';
                resultElement.style.border = '1px solid var(--border-color)';
                resultElement.innerHTML = '<p style="color: var(--text-secondary); margin:0;">Please select a catalogue first.</p>';
                return;
            }

            if (!searchTerm) {
                resultElement.style.display = 'block';
                resultElement.style.background = 'var(--hover-bg)';
                resultElement.style.border = '1px solid var(--border-color)';
                resultElement.innerHTML = '<p style="color: var(--text-secondary); margin:0;">Please enter an object name to search.</p>';
                return;
            }

            let vizierSource;
            if (catalog === 'cifuentes25') {
                vizierSource = 'J/A+A/693/A228';
            } else if (catalog === 'cifuentes20') {
                vizierSource = 'J/A+A/642/A115';
            } else if (catalog === 'schweitzer19') {
                vizierSource = 'J/A+A/625/A68';
            } else if (catalog === 'martinez-rodriguez19') {
                vizierSource = 'J/ApJ/887/261';
            } else if (catalog === 'gonzalez-payo24') {
                vizierSource = 'J/A+A/689/A302';
            } else if (catalog === 'cortes-contreras24') {
                vizierSource = 'J/A+A/692/A206';
            }

            resultElement.style.display = 'block';
            resultElement.style.background = 'var(--bg-color)';
            resultElement.style.border = '1px solid var(--border-color)';
            resultElement.innerHTML = '<p style="color: var(--text-secondary); font-style:italic; margin:0;">Searching...</p>';

            try {
                const karmnCatalogues = ['cifuentes25', 'cifuentes20', 'schweitzer19', 'cortes-contreras24'];
                
                let tsvUrl;
                const isKarmnId = searchTerm.match(/^J\d{5}[+-]\d{3}$/i);
                
                if (isKarmnId && karmnCatalogues.includes(catalog)) {
                    tsvUrl = `https://vizier.cds.unistra.fr/viz-bin/asu-tsv?-source=${encodeURIComponent(vizierSource)}&Karmn=${encodeURIComponent(searchTerm)}&-out.max=50&-out.all`;
                } else {
                    tsvUrl = `https://vizier.cds.unistra.fr/viz-bin/asu-tsv?-source=${encodeURIComponent(vizierSource)}&-c=${encodeURIComponent(searchTerm)}&-out.max=1&-out.all`;
                }
                
                const resp = await fetch(tsvUrl);

                if (!resp.ok) {
                    resultElement.style.display = 'block';
                    const vizierUrl = `https://vizier.cds.unistra.fr/viz-bin/VizieR-3?-source=${encodeURIComponent(vizierSource)}&-c=${encodeURIComponent(searchTerm)}&-out.max=1&-out.form=HTML`;
                    resultElement.innerHTML = `<iframe src="${vizierUrl}" style="width: 100%; height: 600px; border: none;" title="VizieR Catalogue Results"></iframe>`;
                    return;
                }

                const text = await resp.text();
                
                const lines = text.split('\n')
                    .map(l => l.trim())
                    .filter(l => l && !l.startsWith('#') && !/^[-=\s\t]+$/.test(l));
                
                if (lines.length < 3) {
                    resultElement.style.background = 'var(--hover-bg)';
                    resultElement.style.border = '1px solid var(--border-color)';
                    const catalogueUrl = `https://vizier.cds.unistra.fr/viz-bin/VizieR?-source=${vizierSource}`;
                    resultElement.innerHTML = `<p style="color: var(--text-secondary); margin:0;">Object not found in this <a href="${catalogueUrl}" target="_blank" style="color: #0084ff; font-weight: 600; text-decoration: underline;">catalogue</a>.</p>`;
                    return;
                }

                const headers = lines[0].split('\t').map(h => h.split(' [')[0].trim());
                const units = lines[1].split('\t').map(u => u.trim());
                const data = lines[2].split('\t');

                const readmeUrl = `https://cdsarc.cds.unistra.fr/viz-bin/ReadMe/${vizierSource}?format=html&tex=true`;
                const catalogueUrl = `https://vizier.cds.unistra.fr/viz-bin/VizieR?-source=${vizierSource}`;

                let html = `<div style="margin-bottom: 1em; padding: 0.8em; background: var(--hover-bg); border-left: 3px solid var(--text-color); font-size: 0.9em; color: var(--text-color);">
                    For detailed information about this <a href="${catalogueUrl}" target="_blank" style="color: #0084ff; font-weight: 600; text-decoration: underline;">catalogue</a>, see the <a href="${readmeUrl}" target="_blank" style="color: #0084ff; font-weight: 600; text-decoration: none;">ReadMe file</a>.
                </div>`;
                
                html += `<div style="font-size: 0.9em; color: var(--text-color);">`;
                
                headers.forEach((header, index) => {
                    const value = data[index] ? data[index].trim() : '';
                    if (value && value !== '---') {
                        let display = `<strong style="color: var(--text-color);">${header}:</strong> ${value}`;
                        const unit = units[index] || '';
                        if (unit && unit !== '---') {
                            display += ` <span style="color: var(--text-secondary);">(${unit})</span>`;
                        }
                        html += `<div style="margin-bottom: 0.5em; color: var(--text-color);">${display}</div>`;
                    }
                });
                html += '</div>';

                resultElement.style.background = 'var(--bg-color)';
                resultElement.style.border = '1px solid var(--border-color)';
                resultElement.innerHTML = html;

            } catch (err) {
                console.error('Catalogue search error:', err);
                resultElement.style.display = 'block';
                const vizierUrl = `https://vizier.cds.unistra.fr/viz-bin/VizieR-3?-source=${encodeURIComponent(vizierSource)}&-c=${encodeURIComponent(searchTerm)}&-out.max=1&-out.form=HTML`;
                resultElement.innerHTML = `<iframe src="${vizierUrl}" style="width: 100%; height: 600px; border: none;" title="VizieR Catalogue Results"></iframe>`;
            }
        }

        const searchElement = document.getElementById('unified-search');
        if (searchElement) {
            searchElement.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    unifiedSearch();
                }
            });
        }

        // ==========================================
        // GLOBAL AUDIO PLAYER
        // ==========================================
        function togglePlayGlobal() {
            const audio = document.getElementById('global-audio');
            const playBtn = document.querySelector('#global-player .play-btn');
            if (audio.paused) {
                audio.play();
                playBtn.textContent = '‚ùö‚ùö';
            } else {
                audio.pause();
                playBtn.textContent = '‚ñ∂';
            }
        }

        function setProgressGlobal(e) {
            const audio = document.getElementById('global-audio');
            const container = e.currentTarget;
            const rect = container.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            audio.currentTime = percent * audio.duration;
        }

        function loadTrack(src, el) {
            const audio = document.getElementById('global-audio');
            if (!audio) return;
            
            const absoluteSrc = new URL(src, location.href).href;
            if (audio.src !== absoluteSrc) audio.src = src;
            audio.play().catch(() => {});

            // Update UI states - remove playing class from all track elements across all sections
            document.querySelectorAll('.track-list li, ul li[onclick*="loadTrack"]').forEach(li => li.classList.remove('playing'));
            el.classList.add('playing');

            const playBtn = document.querySelector('#global-player .play-btn');

            audio.onplaying = () => {
                if (playBtn) playBtn.textContent = '‚ùö‚ùö';
            };
            
            audio.onpause = () => {
                if (playBtn) playBtn.textContent = '‚ñ∂';
            };
            
            audio.onended = () => {
                el.classList.remove('playing');
                if (playBtn) playBtn.textContent = '‚ñ∂';
            };
        }

        // Audio player event listeners - with retry mechanism
        function setupAudioPlayer() {
            try {
                const audioElement = document.getElementById('global-audio');
                const progressBar = document.getElementById('global-progress-bar');
                const currentTimeEl = document.getElementById('global-current-time');
                const durationEl = document.getElementById('global-duration');
                
                if (!audioElement || !progressBar || !currentTimeEl || !durationEl) {
                    // Retry after a short delay if elements not found
                    setTimeout(setupAudioPlayer, 100);
                    return;
                }
                
                audioElement.addEventListener('timeupdate', () => {
                    try {
                        const progress = (audioElement.currentTime / audioElement.duration) * 100;
                        if (progressBar) {
                            progressBar.style.width = progress + '%';
                        }
                        
                        const minutes = Math.floor(audioElement.currentTime / 60);
                        const seconds = Math.floor(audioElement.currentTime % 60);
                        const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        if (currentTimeEl) {
                            currentTimeEl.textContent = timeString;
                        }
                    } catch (e) {
                        console.error('Error in timeupdate:', e);
                    }
                });

                audioElement.addEventListener('loadedmetadata', () => {
                    try {
                        const minutes = Math.floor(audioElement.duration / 60);
                        const seconds = Math.floor(audioElement.duration % 60);
                        const durationString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        if (durationEl) {
                            durationEl.textContent = durationString;
                        }
                    } catch (e) {
                        console.error('Error in loadedmetadata:', e);
                    }
                });
            } catch (e) {
                console.error('Error in setupAudioPlayer:', e);
            }
        }
        
        setupAudioPlayer();

        // ==========================================
        // LYRICS FUNCTIONALITY
        // ==========================================
        const lyricsDatabase = {
            triangles: {
                title: "TRIANGLES (2018)",
                lyrics: `If the triangles made a god
If the triangles made a god
They would give him three sides`
            },
            dormant: {
                title: "DORMANT (2019)",
                lyrics: `Again you fail to see
It's no one but you
The powers that be`
            },
            haunt: {
                title: "HAUNT (2019)",
                lyrics: `There is no plan
There is no purpose
Zweck sein selbst ist jegliches Tier
(Each animal is an end in itself)`
            },
            bones: {
                title: "BONES (2019)",
                lyrics: `[These lyrics are lost forever]`
            },
            puma: {
                title: "PUMA (2021)",
                lyrics: `Eumetazoa
Deuterostomia
Chordata
Vertebrata
Gnathostomata
Tetrapoda
Mammalia
Theria
Placentalia
Laurasiatheria
Carnivora
Feliformia
Felidae
Felinae
Puma
Puma concolor`
            },
            pig: {
                title: "PIG (2024)",
                lyrics: `(Instrumental)`
            }
        };

        function showLyrics(songId) {
            const song = lyricsDatabase[songId];
            if (!song) {
                alert('Letras no disponibles para esta canci√≥n.');
                return;
            }
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'lyrics-modal';
            let trivia = '';
            if (songId === 'triangles') {
                trivia = `<div class="lyrics-trivia" style="margin-top:1.5em; color:black; font-size:0.98em;">
                <span style="font-weight: bold; color: black;">Trivia:</span><br>
                <ul style="margin:0.25em 0 0 1.2em; padding:0; list-style-type:disc;">
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">The intro riff was repeated at least 100 times.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">With the exception of some fills, the song was improvised in one take.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Guitar recorded with Windows Sound Recorder (.wav converted to .mp3).</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Left index finger bruised after repeatedly hitting a prominent edge of the Showmaster neck.</li>
                </ul>
                </div>`;
            } else if (songId === 'bones') {
                trivia = `<div class="lyrics-trivia" style="margin-top:1.5em; color:black; font-size:0.98em;">
                <span style="font-weight: bold; color: black;">Trivia:</span><br>
                <ul style="margin:0.25em 0 0 1.2em; padding:0; list-style-type:disc;">
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">The intro riff was repeated approximately 500 times.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Around 1,500 audio fragments were recorded but not used in the final mix.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Vocals include Rottweiler and German Shepherd samples.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">The main microphone failed and was replaced with an iPhone.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Recording, production, and mixing were completed in about 72 hours.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Released on Good Friday.</li>
                </ul>
                </div>`;
            } else if (songId === 'dormant') {
                trivia = `<div class="lyrics-trivia" style="margin-top:1.5em; color:black; font-size:0.98em;">
                <span style="font-weight: bold; color: black;">Trivia:</span><br>
                <ul style="margin:0.25em 0 0 1.2em; padding:0; list-style-type:disc;">
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">The intro riff was repeated at least one hundred times.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Guitar played while barefoot like Steven Wilson.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Some sounds achieved with scissors.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Officially released on Maundy Thursday.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">A broken PC was used for recording.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Recording, production, and mixing took less than 48 hours.</li>
                </ul>
                </div>`;
            } else if (songId === 'haunt') {
                trivia = `<div class="lyrics-trivia" style="margin-top:1.5em; color:black; font-size:0.98em;">
                <span style="font-weight: bold; color: black;">Trivia:</span><br>
                <ul style="margin:0.25em 0 0 1.2em; padding:0; list-style-type:disc;">
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Recorded sitting on a wooden bench, eating pickles.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">Features an undefined jungle animal, probably a lemur.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">The song that has caused the most fingertip pain.</li>
                    <li style="margin:0; padding:0; line-height:1.1; display:list-item;">First song conceived in Guitar Pro (originally called 'Melting Sun').</li>
                </ul>
                </div>`;
            }
            modal.innerHTML = `
                <div class="lyrics-content">
                    <div class="lyrics-header">
                        <h3>${song.title}</h3>
                        <span class="close-lyrics" onclick="closeLyrics()">&times;</span>
                    </div>
                    <div class="lyrics-text">
                        <span style="font-weight: bold; color: black;">Human lyrics:</span><br>
                        <span style="font-style: italic;">${song.lyrics.replace(/\n/g, '<br>')}</span>
                        ${trivia}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeLyrics();
            });
        }
        
        function closeLyrics() {
            const modal = document.querySelector('.lyrics-modal');
            if (modal) modal.remove();
        }
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeLyrics();
        });
    </script>
</body>
</html>